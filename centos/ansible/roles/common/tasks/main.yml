---
- name: "OS fingerprinting "
  debug:
    msg:
    - " ansible_os_family: {{ hostvars[inventory_hostname].ansible_os_family }} "
    - " ansible_distribution: {{ hostvars[inventory_hostname].ansible_distribution }}"
    - " ansible_distribution_major_version: {{ hostvars[inventory_hostname].ansible_distribution_major_version }}"
    - " ansible_distribution_release: {{ hostvars[inventory_hostname].ansible_distribution_release }}"
    - " ansible_distribution_version: {{ hostvars[inventory_hostname].ansible_distribution_version }}"

# - name: "Add /etc/hosts entries"
#   include_tasks: hosts_entry.yml
#
# - name: "Add /etc/resolv.conf entries"
#   include_tasks: resolv_entry.yml
#
# - name: "Install {{ ansible_distribution }}-{{ ansible_distribution_version }}"
#   include_tasks: "{{ ansible_distribution }}_{{ ansible_distribution_version }}_install.yml"

- name: Add idrc-provisioning key to authorized_keys
  authorized_key:
    user: root
    key: "{{ lookup('file', 'provisioning.pub') }}"
    state: present

- name: Tweak sshd_config
  lineinfile:
    dest: /etc/ssh/sshd_config
    regexp: ".*UseDNS.*"
    line: "UseDNS no"

- name: Configure GRUB to enable serial console
  copy:
    src: grub
    dest: /etc/default/grub
    mode: '0644'
    owner: root
    group: root
    backup: no

- name: Regenerate GRUB configuration
  command: "/usr/sbin/grub2-mkconfig -o /boot/grub2/grub.cfg"

- name: Install common packages
  yum:
    name: "{{ item }}"
    state: latest
  with_items: "{{ common_packages }}"
